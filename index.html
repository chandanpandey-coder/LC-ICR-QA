<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ICR Feedback Form</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
body{font-family:Inter,sans-serif;background:#eef4fa;padding:40px}
.container{max-width:1200px;margin:auto;background:#fff;border-radius:18px;padding:56px}
.section{margin-top:56px}
label{display:block;margin-top:28px;font-weight:600}
select,input,textarea{
  width:100%;margin-top:10px;padding:14px;
  border-radius:10px;border:1px solid #cbd5e1
}
textarea{min-height:120px;resize:vertical}
.hidden{display:none}
button{
  margin-top:60px;padding:10px 26px;
  border:none;border-radius:10px;
  background:#3b82f6;color:#fff;
  cursor:pointer
}
</style>
</head>

<body>
<div class="container">
<h1>ICR â€“ Feedback Form</h1>

<form id="icrForm" novalidate>
<input type="hidden" name="Final_Score" id="Final_Score">

<!-- BASIC -->
<div class="section">
<label>Loan Number *</label>
<input name="LoanNumber" required>

<label>Reviewer Name *</label>
<input name="ReviewerName" required>
</div>

<!-- LOAN TYPE -->
<div class="section">
<label>Loan Type *</label>
<select name="LoanType" onchange="toggleLoan(this.value)" required>
<option value="">- Select -</option>
<option value="Refi">Refi</option>
<option value="Purchase">Purchase</option>
</select>
</div>

<!-- ========================== REFI ========================== -->
<div id="refiSection" class="hidden">

<div class="section">
<label>Are Entity documents received (except OA/Bylaws)? *</label>
<select name="Refi_EntityDocs" onchange="entityDocs(this,'Refi')" required>
<option value="">- Select -</option>
<option>Yes</option>
<option>No</option>
</select>
</div>

<div id="RefiEntityCorrect" class="section hidden">
<label>Is Entity Data entered correctly? *</label>
<select name="Refi_EntityCorrect" onchange="entityCorrect(this,'Refi')">
<option value="">- Select -</option>
<option>Yes</option>
<option>No</option>
</select>
</div>

<div id="RefiEntityDetails" class="section hidden">
<label>EIN updated?</label>
<select name="Refi_EIN"><option></option><option>Yes</option><option>No</option></select>

<label>Formation updated?</label>
<select name="Refi_Formation"><option></option><option>Yes</option><option>No</option></select>

<label>COGS updated?</label>
<select name="Refi_COGS"><option></option><option>Yes</option><option>No</option><option>N/A</option></select>

<label>Foreign Registration updated?</label>
<select name="Refi_Foreign"><option></option><option>Yes</option><option>No</option><option>N/A</option></select>
</div>

<div class="section">
<label>Are OA / Bylaws received?</label>
<select name="Refi_OA" onchange="toggleOA(this,'Refi')" required>
<option></option><option>Yes</option><option>No</option>
</select>

<div id="RefiOA" class="hidden">
<label>OA highlighted correctly?</label>
<select name="Refi_OA_Highlighted"><option></option><option>Yes</option><option>No</option></select>

<label>Signature updated correctly?</label>
<select name="Refi_Signature"><option></option><option>Yes</option><option>No</option></select>
</div>
</div>

<div id="RefiChildGate" class="section hidden">
<label>Closing Entity Type</label>
<select name="Refi_Child_Type" onchange="toggleSection(this,'RefiChild','Child Entity')">
<option></option><option>No Child Entity</option><option>Child Entity</option>
</select>

<div id="RefiChild" class="hidden">
<label>Child Entity info updated?</label>
<select name="Refi_Child_Info"><option></option><option>Yes</option><option>No</option></select>
</div>
</div>

<div class="section">
<label>Is Payoff received?</label>
<select name="Refi_Payoff" onchange="toggleSection(this,'RefiPayoff','Yes')">
<option></option><option>Yes</option><option>No</option><option>N/A</option>
</select>

<div id="RefiPayoff" class="hidden">
<label>Payoff Good Through updated?</label>
<select name="Refi_Payoff_GT"><option></option><option>Yes</option><option>No</option></select>
</div>
</div>

<div class="section">
<label>Is Appraisal received?</label>
<select name="Refi_Appraisal" onchange="toggleSection(this,'RefiOOR','Yes')">
<option></option><option>Yes</option><option>No</option>
</select>

<div id="RefiOOR" class="hidden">
<label>OOR updated correctly?</label>
<select name="Refi_OOR"><option></option><option>Yes</option><option>No</option></select>
</div>
</div>

</div>

<!-- ========================== PURCHASE ========================== -->
<div id="purchaseSection" class="hidden">

<div class="section">
<label>Are Entity documents received (except OA/Bylaws)? *</label>
<select name="Pur_EntityDocs" onchange="entityDocs(this,'Pur')" required>
<option></option><option>Yes</option><option>No</option>
</select>
</div>

<div id="PurEntityCorrect" class="section hidden">
<label>Is Entity Data entered correctly?</label>
<select name="Pur_EntityCorrect" onchange="entityCorrect(this,'Pur')">
<option></option><option>Yes</option><option>No</option>
</select>
</div>

<div id="PurEntityDetails" class="section hidden">
<label>EIN updated?</label>
<select name="Pur_EIN"><option></option><option>Yes</option><option>No</option></select>
<label>Formation updated?</label>
<select name="Pur_Formation"><option></option><option>Yes</option><option>No</option></select>
<label>COGS updated?</label>
<select name="Pur_COGS"><option></option><option>Yes</option><option>No</option><option>N/A</option></select>
<label>Foreign Registration updated?</label>
<select name="Pur_Foreign"><option></option><option>Yes</option><option>No</option><option>N/A</option></select>
</div>

<div class="section">
<label>Are OA / Bylaws received?</label>
<select name="Pur_OA" onchange="toggleOA(this,'Pur')" required>
<option></option><option>Yes</option><option>No</option>
</select>

<div id="PurOA" class="hidden">
<label>OA highlighted correctly?</label>
<select name="Pur_OA_Highlighted"><option></option><option>Yes</option><option>No</option></select>
<label>Signature updated correctly?</label>
<select name="Pur_Signature"><option></option><option>Yes</option><option>No</option></select>
</div>
</div>

<div id="PurChildGate" class="section hidden">
<label>Closing Entity Type</label>
<select name="Pur_Child_Type" onchange="toggleSection(this,'PurChild','Child Entity')">
<option></option><option>No Child Entity</option><option>Child Entity</option>
</select>

<div id="PurChild" class="hidden">
<label>Child Entity info updated?</label>
<select name="Pur_Child_Info"><option></option><option>Yes</option><option>No</option></select>
</div>
</div>

<div class="section">
<label>Is Purchase Contract received?</label>
<select name="Pur_Contract" onchange="toggleSection(this,'PurACD','Yes')">
<option></option><option>Yes</option><option>No</option>
</select>

<div id="PurACD" class="hidden">
<label>Is ACD updated correctly?</label>
<select name="Pur_ACD"><option></option><option>Yes</option><option>No</option></select>
</div>
</div>

<div class="section">
<label>Is Appraisal received?</label>
<select name="Pur_Appraisal" onchange="toggleSection(this,'PurOOR','Yes')">
<option></option><option>Yes</option><option>No</option><option>N/A</option>
</select>

<div id="PurOOR" class="hidden">
<label>OOR updated correctly?</label>
<select name="Pur_OOR"><option></option><option>Yes</option><option>No</option></select>
</div>
</div>

</div>

<!-- FINAL QUESTIONS -->
<div class="section">
<label>Is the Follow up Done?</label>
<select name="Follow_Up_Done"><option></option><option>Yes</option><option>No</option></select>
<label>Are the Comments Updated?</label>
<select name="Comments_Updated"><option></option><option>Yes</option><option>No</option></select>
<label>Is the Deal Name updated?</label>
<select name="Deal_Name_Updated"><option></option><option>Yes</option><option>No</option></select>
</div>

<div class="section">
<label>Comments</label>
<textarea name="Final_Comments"></textarea>
</div>

<button type="submit">Submit</button>
</form>
</div>

<script>
function scoreEntity(p){
  const c=document.querySelector(`[name="${p}_EntityCorrect"]`)?.value;
  if(c==="Yes") return {s:10,m:10};
  if(c!=="No") return {s:0,m:0};
  const f=["EIN","Formation","COGS","Foreign"];
  let a=0,y=0;
  f.forEach(x=>{
    const v=document.querySelector(`[name="${p}_${x}"]`)?.value;
    if(v && v!=="N/A"){a++; if(v==="Yes")y++;}
  });
  return a?{s:(y/a)*10,m:10}:{s:0,m:0};
}

function yn(n,m){
  const v=document.querySelector(`[name="${n}"]`)?.value;
  if(!v) return {s:0,m:0};
  return {s:v==="Yes"?m:0,m};
}

function calculateScore(){
  let t=0,m=0;
  const type=document.querySelector('[name="LoanType"]').value;
  const p=type==="Refi"?"Refi":"Pur";

  let e=scoreEntity(p); t+=e.s; m+=e.m;

  if(document.querySelector(`[name="${p}_OA"]`)?.value==="Yes"){
    let a=yn(`${p}_OA_Highlighted`,5), s=yn(`${p}_Signature`,5);
    t+=a.s+s.s; m+=10;
  }

  if(document.querySelector(`[name="${p}_Child_Type"]`)?.value==="Child Entity"){
    let c=yn(`${p}_Child_Info`,5); t+=c.s; m+=5;
  }

  if(type==="Refi" && document.querySelector('[name="Refi_Payoff"]')?.value==="Yes"){
    let pgt=yn("Refi_Payoff_GT",10); t+=pgt.s; m+=10;
  }

  if(type==="Purchase" && document.querySelector('[name="Pur_Contract"]')?.value==="Yes"){
    let acd=yn("Pur_ACD",10); t+=acd.s; m+=10;
  }

  if(document.querySelector(`[name="${p}_Appraisal"]`)?.value==="Yes"){
    let o=yn(`${p}_OOR`,10); t+=o.s; m+=10;
  }

  ["Follow_Up_Done","Comments_Updated","Deal_Name_Updated"].forEach(q=>{
    let r=yn(q,5); t+=r.s; m+=5;
  });

  return m?((t/m)*100).toFixed(2):"0.00";
}

document.getElementById("icrForm").addEventListener("submit",e=>{
  e.preventDefault();
  document.getElementById("Final_Score").value=calculateScore();
  fetch("YOUR_APPS_SCRIPT_URL",{method:"POST",mode:"no-cors",body:new FormData(icrForm)});
  alert("Submitted");
  icrForm.reset();
});
</script>

</body>
</html>
